# Studio 2 Roadmap - 実装ロードマップ

**Version**: 0.2.0
**Date**: 2026.02.07

---

## 現在の実装状況 (v0.1.0)

### 完了
- [x] プロジェクト初期構造
- [x] Vite + Konva.js セットアップ
- [x] 基本レイアウト（3ペイン）
- [x] SceneModel（共有データモデル）
- [x] ビジュアルエディタ基本（ドラッグ/選択）
- [x] コード生成（Model → JavaScript）
- [x] 1-bitプレビュー（Floyd-Steinberg）

### 未実装
- [ ] コード → Model パース（双方向同期）
- [ ] Transform handles（回転/リサイズ）
- [ ] 画像インポート
- [ ] プリンター接続
- [ ] ゲームパターンテンプレート
- [ ] Flow View（ノードグラフ）

---

## Phase 1: エディタ基盤強化 (v0.2.0)

### 1.1 ビジュアルエディタ改善
| 機能 | 説明 | 優先度 |
|------|------|--------|
| Transform handles | 回転/リサイズハンドル | 高 |
| Multi-select | Shift+クリックで複数選択 | 高 |
| Alignment guides | スナップガイド表示 | 中 |
| Layer panel | オブジェクトのZ順序管理 | 中 |
| Undo/Redo | Ctrl+Z / Ctrl+Shift+Z | 高 |

### 1.2 オブジェクトタイプ追加
| タイプ | 説明 | SDK対応 |
|--------|------|---------|
| Line | 直線 | 新規API |
| Circle | 円/楕円 | 新規API |
| Polygon | 多角形 | 新規API |
| Image | 画像（ディザリング済み） | 既存 |
| Sprite | スプライト参照 | 既存 |

### 1.3 プロパティパネル
```
┌─────────────────────────┐
│ Properties              │
├─────────────────────────┤
│ Position                │
│   X: [120]  Y: [50]     │
│ Size                    │
│   W: [200]  H: [80]     │
│ Rotation: [0°]          │
├─────────────────────────┤
│ Text Properties         │
│   Content: [Hello]      │
│   Font: [Misaki ▼]      │
│   Scale: [1]            │
│   Align: [left ▼]       │
└─────────────────────────┘
```

---

## Phase 2: 双方向同期 (v0.3.0)

### 2.1 Code → Model パース
ビジュアル編集とコード編集の双方向同期。

```javascript
// コードからModelを再構築
const parser = new CodeParser();
const model = parser.parse(`
  section.text(100, 'Hello');
  section.rect(50, 50, 200, 100, true);
`);

visualEditor.loadModel(model);
```

### 2.2 Monaco Editor統合
| 機能 | 説明 |
|------|------|
| Syntax highlighting | JavaScript + SDK専用ハイライト |
| Autocomplete | SDK APIの補完 |
| Error markers | コンパイルエラー表示 |
| Format on save | 自動フォーマット |

### 2.3 リアルタイム同期
```
┌────────────────┐     ┌────────────────┐
│ Visual Editor  │◀───▶│  Code Editor   │
└───────┬────────┘     └───────┬────────┘
        │                      │
        ▼                      ▼
    ┌────────────────────────────┐
    │       SceneModel           │
    │  (Single Source of Truth)  │
    └────────────────────────────┘
```

---

## Phase 3: Flow View (v0.4.0)

### 3.1 ノードグラフエディタ
セクション間の遷移をノードとエッジで可視化。

```
┌─────────┐        ┌─────────┐
│  start  │───A───▶│  cave   │
└─────────┘        └────┬────┘
     │                  │
     B                  A
     ▼                  ▼
┌─────────┐        ┌─────────┐
│  town   │        │  boss   │
└─────────┘        └─────────┘
```

### 3.2 ノードタイプ
| ノード | 説明 | アイコン |
|--------|------|----------|
| Section | 通常セクション | ▢ |
| Branch | 条件分岐 | ◇ |
| Random | ランダム分岐 | 🎲 |
| Sync | 同期ポイント | ⇄ |
| End | 終了ノード | ● |

### 3.3 エッジ属性
| 属性 | 説明 |
|------|------|
| Button | どのボタンで遷移するか |
| Condition | 変数条件 |
| Probability | ランダム分岐時の確率 |

### 3.4 UI/UX
- ドラッグでノード配置
- ポートからドラッグでエッジ作成
- ダブルクリックでセクション編集モード
- ミニマップ表示

---

## Phase 4: ゲームパターンテンプレート (v0.5.0)

### 4.1 テンプレート選択UI
```
┌─────────────────────────────────────────┐
│ New Game                                │
├─────────────────────────────────────────┤
│ ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│ │ REVEAL  │ │  LOOP   │ │ FEEDER  │    │
│ │         │ │         │ │         │    │
│ │ [選択]  │ │ [選択]  │ │ [選択]  │    │
│ └─────────┘ └─────────┘ └─────────┘    │
│                                         │
│ ┌─────────┐ ┌─────────┐ ┌─────────┐    │
│ │  SYNC   │ │ BACKLOG │ │GENERATOR│    │
│ │         │ │         │ │         │    │
│ │ [選択]  │ │ [選択]  │ │ [選択]  │    │
│ └─────────┘ └─────────┘ └─────────┘    │
└─────────────────────────────────────────┘
```

### 4.2 テンプレート内容
各パターンにスターターコード + サンプルFlow + 推奨設定を含む。

| パターン | 初期セクション | 初期Flow | 推奨入力 |
|----------|----------------|----------|----------|
| REVEAL | intro, scene1, end | intro → scene1 → end | A/B |
| LOOP | start, checkpoint, rewind | start ⇄ checkpoint | A/B + フェーダー |
| GENERATOR | setup, generate, print | setup → generate → print | A + フェーダー |

### 4.3 勝利条件エディタ
```
┌─────────────────────────────────────────┐
│ Win Conditions                          │
├─────────────────────────────────────────┤
│ ☑ Reach section: [ending_good ▼]       │
│ ☐ Variable condition:                   │
│     [hp ▼] [>= ▼] [50]                  │
│ ☐ Time limit: [__] seconds              │
│ ☐ All players alive                     │
└─────────────────────────────────────────┘
```

---

## Phase 5: プリンター接続 (v0.6.0)

### 5.1 接続UI
```
┌─────────────────────────────────────────┐
│ Printer Connection                      │
├─────────────────────────────────────────┤
│ Status: ○ Disconnected                  │
│                                         │
│ [Connect via USB Serial]                │
│ [Connect via WiFi]                      │
│                                         │
│ ─────────────────────────               │
│ Device: Pico 2W (COM3)                  │
│ Baud: 921600                            │
│ Protocol: PGP v2.2.0                    │
└─────────────────────────────────────────┘
```

### 5.2 実機プレビュー
| 機能 | 説明 |
|------|------|
| Test print | 選択セクションを印刷 |
| Live sync | 編集をリアルタイム反映 |
| Speed control | 印刷速度調整 |
| Heat control | 印字濃度調整 |

### 5.3 デバッグモード
```
┌─────────────────────────────────────────┐
│ Debug Console                           │
├─────────────────────────────────────────┤
│ [▶ Run] [⏸ Pause] [⏹ Stop] [↻ Reset]   │
│                                         │
│ > PROGRAM_START                         │
│ > LABEL 0                               │
│ > TEXT 0,0 "Hello"                      │
│ > JUMP_IF_BTN A → 1                     │
│ > [Waiting for button...]               │
│                                         │
│ Variables:                              │
│   var[0] = 100                          │
│   var[1] = 0                            │
│                                         │
│ Input: BTN=0x00 FADER=2048              │
└─────────────────────────────────────────┘
```

---

## Phase 6: 高度な機能 (v1.0.0)

### 6.1 画像エディタ
- 画像インポート（PNG/JPG）
- クロップ/リサイズ
- ディザリングプレビュー
- スプライト切り出し

### 6.2 スプライトエディタ
- 8x8 / 16x16 / 32x32 グリッド
- ドット打ち
- アニメーション定義
- スプライトシート管理

### 6.3 エクスポート
| 形式 | 説明 |
|------|------|
| .pgp | PGPバイナリ（オフライン実行用） |
| .js | JavaScript SDK コード |
| .json | プロジェクトファイル |
| .html | スタンドアロンHTML |

### 6.4 ギャラリー統合
- ゲーム公開
- メタデータ編集
- サムネイル生成
- プレイ統計

---

## 技術的課題

| 課題 | 対策 |
|------|------|
| 双方向パース精度 | AST解析、コメント保持 |
| 大規模ゲームのパフォーマンス | 仮想化、遅延読み込み |
| WiFi同期の遅延 | ローカルWiFi、予測同期 |
| ブラウザ互換性 | Polyfill、フォールバック |

---

## マイルストーン

| バージョン | 目標 | 予定 |
|------------|------|------|
| v0.2.0 | エディタ基盤完成 | Week 2 |
| v0.3.0 | 双方向同期 | Week 3-4 |
| v0.4.0 | Flow View | Week 5-6 |
| v0.5.0 | テンプレート | Week 7 |
| v0.6.0 | プリンター接続 | Week 8-9 |
| v1.0.0 | 正式リリース | Week 12 |
